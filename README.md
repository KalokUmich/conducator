# Conductor

> AI-Powered Collaborative Coding for VS Code

[English](#english) | [ä¸­æ–‡](#ä¸­æ–‡)

---

<a name="english"></a>
## English

Conductor is a VS Code extension that combines **Live Share**, **real-time chat**, and **AI-powered code generation** for seamless team collaboration.

### âœ¨ Key Features

| Feature | Description |
|---------|-------------|
| ğŸ”— **Live Share Integration** | Share your coding session with teammates in real-time |
| ğŸ’¬ **Real-time Chat** | WhatsApp-style chat with typing indicators and message grouping |
| ğŸ“ **File Sharing** | Share images, PDFs, audio files (up to 20MB) in chat |
| ğŸ¤– **AI Code Generation** | Generate code changes using AI (MockAgent for testing) |
| ğŸ‘¥ **Role-Based Access** | Lead (full control) vs Member (chat only) permissions |
| ğŸ”„ **Auto Apply** | Automatically apply safe, small changes |
| ğŸ“ **Diff Preview** | Review AI-generated changes before applying |
| ğŸ“Š **Audit Logging** | Track all applied changes with DuckDB |
| ğŸ“± **Mobile Support** | Web version works on mobile devices |

### ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VS Code Host                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Conductor  â”‚  â”‚  Live Share â”‚  â”‚   Editor    â”‚              â”‚
â”‚  â”‚   WebView   â”‚â”€â”€â”‚  Extension  â”‚â”€â”€â”‚  Workspace  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                                                        â”‚
â”‚         â”‚ WebSocket + REST                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Backend (FastAPI)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Chat   â”‚  â”‚  Agent  â”‚  â”‚ Summary â”‚  â”‚ Policy  â”‚  â”‚ Audit  â”‚ â”‚
â”‚  â”‚ (WS)    â”‚  â”‚ (Mock)  â”‚  â”‚         â”‚  â”‚         â”‚  â”‚(DuckDB)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”’ Security Architecture

Conductor implements a **server-side authentication model** where the backend is the source of truth for user identity and permissions. This prevents users from forging credentials or escalating privileges.

#### Key Security Principles

| Principle | Description |
|-----------|-------------|
| **Backend-Assigned Identity** | User IDs are generated by the backend (UUID v4) upon WebSocket connection, never by clients |
| **Role-Based Access Control** | Roles (`host`/`guest`) are determined by the backend based on room creation order |
| **Server-Side Validation** | All sensitive operations are validated server-side before execution |
| **Client Data Untrusted** | Backend ignores client-provided userId/role and uses only assigned values |

#### Authentication Flow

```
1. Client connects to WebSocket
   â””â”€â†’ Backend generates userId (UUID v4)
   â””â”€â†’ Backend determines role:
       â€¢ First user in room â†’ host
       â€¢ Subsequent users â†’ guest

2. Backend sends: {type: "connected", userId: "xxx", role: "host/guest"}

3. Client stores and uses backend-assigned credentials

4. For ALL subsequent messages:
   â””â”€â†’ Backend uses assigned userId/role
   â””â”€â†’ Client-provided values are IGNORED
```

#### Permission Model

| Operation | Host | Guest | Notes |
|-----------|:----:|:-----:|-------|
| Send chat messages | âœ… | âœ… | |
| Share files | âœ… | âœ… | |
| Share code snippets | âœ… | âœ… | |
| Send typing indicators | âœ… | âœ… | |
| End session | âœ… | âŒ | Only host can terminate |
| Execute AI features | âœ… | âŒ | Future: `executor` role |

#### Future Roles

| Role | Description |
|------|-------------|
| `host` | Room creator, full permissions |
| `guest` | Participant, limited permissions |
| `executor` | (Planned) Can execute AI features like host |

### ğŸ“¦ Project Structure

```
Conductor/
â”œâ”€â”€ backend/               # FastAPI backend server
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ chat/         # WebSocket chat rooms
â”‚   â”‚   â”œâ”€â”€ agent/        # AI code generation (MockAgent)
â”‚   â”‚   â”œâ”€â”€ policy/       # Auto-apply policy rules
â”‚   â”‚   â”œâ”€â”€ audit/        # DuckDB audit logging
â”‚   â”‚   â””â”€â”€ summary/      # Chat summarization
â”‚   â””â”€â”€ tests/            # Backend tests (104 tests)
â”œâ”€â”€ extension/            # VS Code extension
â”‚   â”œâ”€â”€ src/              # TypeScript source
â”‚   â””â”€â”€ media/            # WebView HTML/CSS
â”œâ”€â”€ config/               # Configuration files
â”‚   â””â”€â”€ conductor.yaml    # Main config (ngrok, LLM, limits)
â””â”€â”€ shared/               # Shared schemas
    â””â”€â”€ changeset.schema.json
```

### ğŸš€ Quick Start

#### Prerequisites

- Python 3.10+
- Node.js 18+
- VS Code 1.85+

#### 1. Clone the Repository

```bash
git clone https://github.com/yourusername/Conductor.git
cd Conductor
```

#### 2. Set Up Backend

```bash
# Create virtual environment
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# or: .venv\Scripts\activate  # Windows

# Install dependencies
cd backend
pip install -r requirements.txt

# Start server
uvicorn app.main:app --reload

# Or use Makefile (recommended, from project root)
cd ..
make run-backend
```

#### 3. Set Up Extension

```bash
cd extension
npm install
npm run compile
```

#### 4. Launch Extension (Development Mode)

1. Open `extension/` folder in VS Code
2. Press `F5` to launch Extension Development Host
3. The Conductor panel appears in the sidebar

#### 5. Install Extension (Production Mode)

**Option A: Install from VSIX file**

```bash
# Build the VSIX package
cd extension
npx vsce package
```

Then in VS Code:
1. Press `Ctrl+Shift+P` (or `Cmd+Shift+P` on Mac)
2. Type `Extensions: Install from VSIX...`
3. Select the generated `ai-collab-0.0.1.vsix` file
4. Reload VS Code

**Option B: Share VSIX with team members**

1. Send the `.vsix` file to team members
2. They install it using the same steps above

### âš™ï¸ Configuration

Edit `config/conductor.yaml`:

```yaml
server:
  host: "0.0.0.0"
  port: 8000

ngrok:
  enabled: false
  authtoken: "your-ngrok-token"

change_limits:
  max_files: 2
  max_lines: 50
```

### ğŸ“– Documentation

- [Backend API Documentation](backend/README.md)
- [Extension Documentation](extension/README.md)
- [Testing Guide](TESTING.md)

### ğŸ¤ Collaboration Workflow

1. **Host** opens VS Code and starts Conductor
2. Live Share session auto-starts and generates invite URL
3. **Host** shares the invite URL with team members
4. **Guests** click the link â†’ install extension â†’ join session
5. Team collaborates via chat while Host can generate AI code
6. Changes are reviewed and applied to shared workspace

---

<a name="ä¸­æ–‡"></a>
## ä¸­æ–‡

Conductor æ˜¯ä¸€ä¸ª VS Code æ‰©å±•ï¼Œå°† **Live Share**ã€**å®æ—¶èŠå¤©** å’Œ **AI ä»£ç ç”Ÿæˆ** ç»“åˆåœ¨ä¸€èµ·ï¼Œå®ç°æ— ç¼å›¢é˜Ÿåä½œã€‚

### âœ¨ ä¸»è¦åŠŸèƒ½

| åŠŸèƒ½ | æè¿° |
|------|------|
| ğŸ”— **Live Share é›†æˆ** | ä¸é˜Ÿå‹å®æ—¶å…±äº«ç¼–ç ä¼šè¯ |
| ğŸ’¬ **å®æ—¶èŠå¤©** | WhatsApp é£æ ¼èŠå¤©ï¼Œæ”¯æŒè¾“å…¥æŒ‡ç¤ºå™¨å’Œæ¶ˆæ¯åˆ†ç»„ |
| ğŸ“ **æ–‡ä»¶å…±äº«** | åœ¨èŠå¤©ä¸­åˆ†äº«å›¾ç‰‡ã€PDFã€éŸ³é¢‘æ–‡ä»¶ï¼ˆæœ€å¤§ 20MBï¼‰ |
| ğŸ¤– **AI ä»£ç ç”Ÿæˆ** | ä½¿ç”¨ AI ç”Ÿæˆä»£ç æ›´æ”¹ï¼ˆæµ‹è¯•ç”¨ MockAgentï¼‰ |
| ğŸ‘¥ **åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶** | Hostï¼ˆå®Œå…¨æ§åˆ¶ï¼‰vs Guestï¼ˆæœ‰é™æƒé™ï¼‰ |
| ğŸ”„ **è‡ªåŠ¨åº”ç”¨** | è‡ªåŠ¨åº”ç”¨å®‰å…¨çš„å°å‹æ›´æ”¹ |
| ğŸ“ **å·®å¼‚é¢„è§ˆ** | åœ¨åº”ç”¨ä¹‹å‰å®¡æŸ¥ AI ç”Ÿæˆçš„æ›´æ”¹ |
| ğŸ“Š **å®¡è®¡æ—¥å¿—** | ä½¿ç”¨ DuckDB è·Ÿè¸ªæ‰€æœ‰åº”ç”¨çš„æ›´æ”¹ |
| ğŸ“± **ç§»åŠ¨ç«¯æ”¯æŒ** | Web ç‰ˆæœ¬æ”¯æŒåœ¨æ‰‹æœºä¸Šä½¿ç”¨ |

### ğŸ”’ å®‰å…¨æ¶æ„

Conductor å®ç°äº†**æœåŠ¡ç«¯è®¤è¯æ¨¡å‹**ï¼Œåç«¯æ˜¯ç”¨æˆ·èº«ä»½å’Œæƒé™çš„å”¯ä¸€å¯ä¿¡æ¥æºã€‚è¿™å¯ä»¥é˜²æ­¢ç”¨æˆ·ä¼ªé€ å‡­è¯æˆ–æå‡æƒé™ã€‚

#### æ ¸å¿ƒå®‰å…¨åŸåˆ™

| åŸåˆ™ | æè¿° |
|------|------|
| **åç«¯åˆ†é…èº«ä»½** | ç”¨æˆ· ID ç”±åç«¯åœ¨ WebSocket è¿æ¥æ—¶ç”Ÿæˆï¼ˆUUID v4ï¼‰ï¼Œè€Œéç”±å®¢æˆ·ç«¯ç”Ÿæˆ |
| **åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶** | è§’è‰²ï¼ˆ`host`/`guest`ï¼‰ç”±åç«¯æ ¹æ®æˆ¿é—´åˆ›å»ºé¡ºåºå†³å®š |
| **æœåŠ¡ç«¯éªŒè¯** | æ‰€æœ‰æ•æ„Ÿæ“ä½œåœ¨æ‰§è¡Œå‰éƒ½ç”±æœåŠ¡ç«¯éªŒè¯ |
| **ä¸ä¿¡ä»»å®¢æˆ·ç«¯æ•°æ®** | åç«¯å¿½ç•¥å®¢æˆ·ç«¯æä¾›çš„ userId/roleï¼Œåªä½¿ç”¨å·²åˆ†é…çš„å€¼ |

#### è®¤è¯æµç¨‹

```
1. å®¢æˆ·ç«¯è¿æ¥ WebSocket
   â””â”€â†’ åç«¯ç”Ÿæˆ userIdï¼ˆUUID v4ï¼‰
   â””â”€â†’ åç«¯ç¡®å®šè§’è‰²ï¼š
       â€¢ æˆ¿é—´ç¬¬ä¸€ä¸ªç”¨æˆ· â†’ host
       â€¢ åç»­ç”¨æˆ· â†’ guest

2. åç«¯å‘é€ï¼š{type: "connected", userId: "xxx", role: "host/guest"}

3. å®¢æˆ·ç«¯å­˜å‚¨å¹¶ä½¿ç”¨åç«¯åˆ†é…çš„å‡­è¯

4. æ‰€æœ‰åç»­æ¶ˆæ¯ï¼š
   â””â”€â†’ åç«¯ä½¿ç”¨å·²åˆ†é…çš„ userId/role
   â””â”€â†’ å®¢æˆ·ç«¯æä¾›çš„å€¼è¢«å¿½ç•¥
```

#### æƒé™æ¨¡å‹

| æ“ä½œ | Host | Guest | è¯´æ˜ |
|------|:----:|:-----:|------|
| å‘é€èŠå¤©æ¶ˆæ¯ | âœ… | âœ… | |
| åˆ†äº«æ–‡ä»¶ | âœ… | âœ… | |
| åˆ†äº«ä»£ç ç‰‡æ®µ | âœ… | âœ… | |
| å‘é€è¾“å…¥çŠ¶æ€ | âœ… | âœ… | |
| ç»“æŸä¼šè¯ | âœ… | âŒ | åªæœ‰ host å¯ä»¥ç»ˆæ­¢ |
| æ‰§è¡Œ AI åŠŸèƒ½ | âœ… | âŒ | æœªæ¥ï¼š`executor` è§’è‰² |

### ğŸš€ å¿«é€Ÿå¼€å§‹

#### å‰ç½®è¦æ±‚

- Python 3.10+
- Node.js 18+
- VS Code 1.85+

#### 1. å…‹éš†ä»“åº“

```bash
git clone https://github.com/yourusername/Conductor.git
cd Conductor
```

#### 2. è®¾ç½®åç«¯

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# æˆ–: .venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
cd backend
pip install -r requirements.txt

# å¯åŠ¨æœåŠ¡å™¨
  uvicorn app.main:app --reload

# æˆ–ä½¿ç”¨ Makefileï¼ˆæ¨èï¼Œä»é¡¹ç›®æ ¹ç›®å½•ï¼‰
cd ..
make run-backend
```

#### 3. è®¾ç½®æ‰©å±•

```bash
cd extension
npm install
npm run compile
```

#### 4. å¯åŠ¨æ‰©å±•ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

1. åœ¨ VS Code ä¸­æ‰“å¼€ `extension/` æ–‡ä»¶å¤¹
2. æŒ‰ `F5` å¯åŠ¨æ‰©å±•å¼€å‘ä¸»æœº
3. Conductor é¢æ¿å‡ºç°åœ¨ä¾§è¾¹æ 

#### 5. å®‰è£…æ‰©å±•ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰

**æ–¹å¼ Aï¼šä» VSIX æ–‡ä»¶å®‰è£…**

```bash
# æ„å»º VSIX åŒ…
cd extension
npx vsce package
```

ç„¶ååœ¨ VS Code ä¸­ï¼š
1. æŒ‰ `Ctrl+Shift+P`ï¼ˆMac ä¸ŠæŒ‰ `Cmd+Shift+P`ï¼‰
2. è¾“å…¥ `Extensions: Install from VSIX...`
3. é€‰æ‹©ç”Ÿæˆçš„ `ai-collab-0.0.1.vsix` æ–‡ä»¶
4. é‡æ–°åŠ è½½ VS Code

**æ–¹å¼ Bï¼šä¸å›¢é˜Ÿæˆå‘˜åˆ†äº« VSIX**

1. å°† `.vsix` æ–‡ä»¶å‘é€ç»™å›¢é˜Ÿæˆå‘˜
2. ä»–ä»¬ä½¿ç”¨ä¸Šè¿°ç›¸åŒæ­¥éª¤å®‰è£…

### âš™ï¸ é…ç½®

ç¼–è¾‘ `config/conductor.yaml`ï¼š

```yaml
server:
  host: "0.0.0.0"
  port: 8000

ngrok:
  enabled: false
  authtoken: "your-ngrok-token"

change_limits:
  max_files: 2
  max_lines: 50
```

### ğŸ¤ åä½œå·¥ä½œæµ

1. **Host** æ‰“å¼€ VS Code å¹¶å¯åŠ¨ Conductor
2. Live Share ä¼šè¯è‡ªåŠ¨å¯åŠ¨å¹¶ç”Ÿæˆé‚€è¯· URL
3. **Host** ä¸å›¢é˜Ÿæˆå‘˜åˆ†äº«é‚€è¯· URL
4. **Guest** ç‚¹å‡»é“¾æ¥ â†’ å®‰è£…æ‰©å±• â†’ åŠ å…¥ä¼šè¯
5. å›¢é˜Ÿé€šè¿‡èŠå¤©åä½œï¼ŒHost å¯ä»¥ç”Ÿæˆ AI ä»£ç 
6. æ›´æ”¹è¢«å®¡æŸ¥å¹¶åº”ç”¨åˆ°å…±äº«å·¥ä½œåŒº

### ğŸ“– æ–‡æ¡£

- [åç«¯ API æ–‡æ¡£](backend/README.md)
- [æ‰©å±•æ–‡æ¡£](extension/README.md)
- [æµ‹è¯•æŒ‡å—](TESTING.md)

---

## License

MIT License - See [LICENSE](LICENSE) for details.

Copyright (c) 2024 Kalok

